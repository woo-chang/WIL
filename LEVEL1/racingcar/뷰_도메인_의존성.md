## 뷰와 도메인 의존성

미션에는 아래와 같은 요구사항이 존재한다.

> domain 패키지가 view에 의존하지 않도록 구현한다.

왜 이러한 요구사항이 존재하는 걸까?

domain이 view를 의존하지 않아야 하는 다음과 같다고 생각했다. **첫째, 역할과 책임의 분리이다.** 도메인은 가지고 있는 필드에 대한 도메인 로직을 수행하는 것이 도메인이 온전히 가져야 할 역할이라고 생각한다. 사용자로부터 들어오는 입력과 사용자에게 전달해야 하는 출력을 담당하는 게 뷰의 역할이라고 생각한다. **둘째, 도메인의 캡슐화이다.** 도메인이 가지고 있는 정보를 캡슐화함으로 도메인의 변경이 다른 곳에 전파되지 않도록 해야 한다.

하지만 위의 답변은 완벽한 대답은 아니다.

결합도가 높든 낮든 간에, 어떤 식으로든 서로가 필요한 객체는 의존 관계를 맺게 되어 있다. 우리는 결합도를 최대한 낮춰 변경 여파를 최소화하고 싶어 하지만, 결국 한 객체는 다른 객체를 알아야만 한다. 그렇다면 누가 누구를 아는 게 나은지 고민해봐야 한다.

소프트웨어 개발 계에서는 경험적으로 view가 domain에 비해 훨씬 변화무쌍하다고 알려져 있다. dos, window, web, mobile 등 비즈니스의 중심이 되는 도메인 개념은 잘 변하지 않는 데 비해 기술 발전으로 인한 view의 변화가 훨씬 빠르다. 새로운 view가 나올 때마다 새로운 비즈니스 코드를 짜야 했던 개발자들의 분노에서 나온 것이 모델과 뷰의 분리 개념이다.

즉, 도메인의 변화보다 뷰의 변화가 더 많으므로 뷰 패키지가 도메인 패키지를 의존한다. 그렇다고 도메인이 변하지 않는 것은 아니다. 또한 view 요구사항을 만족하기 위해 도메인 객체를 바꿔야 하는 경우도 많다. 이런 경우를 위해 dto 등 중간 계층을 두어 양쪽의 변화로부터 안전지대를 만들 수 있도록 한다.

> dto 변환 위치

위의 내용을 바탕으로 컨트롤러와 서비스 중 더 변하지 않는 쪽은 어디일까? 뷰의 요구사항도 만족해야 하는 컨트롤러에 비해 서비스가 더 안전하고 견고하다. 컨트롤러에 있는 클래스를 서비스가 알게 되면 나중에 서비스에서 컨트롤러를 분리하기 어렵게 된다. 의존 흐름을 한 방향으로 가져가는 것이 유지보수가 쉽기에 서비스에서 주로 변환한다.

> dto 변환 방법

dto는 도메인의 정보를 다른 코드로 옮겨주는 것이기에 다른 코드들의 영향을 받는다. 따라서 도메인에 대한 의존을 해야 반대 경우보다 자연스러워질 수 있다. dto로 도메인 자체를 넘겨줘서 만드는 것이 자연스럽다는 의미이지만, 때때로 view의 요구사항은 고정되어있고 도메인만 바뀌는 경우도 존재한다. 이런 경우에는 dto가 고정되어야 하므로 도메인을 받는 것이 아닌 필드 값들을 따로 받아 dto를 보호하기도 한다. 그렇다고 하더라도 도메인이 dto를 알게 하는 경우는 거의 없다.

> 현업에서 Entity -> Dto 변환

팀마다 다르긴 하지만 리뷰어분이 속한 팀에서는 MapStruct라는 라이브러리를 사용한다고 한다. 맵핑 코드 generator로 엔티티와 dto를 인터페이스에 명시하면 간단하게 바꿀 수 있다. 디자인으로 보면 entity와 dto 사이 어댑터 계층을 두어 서로 간의 간섭을 막았다고 볼 수 있다.
